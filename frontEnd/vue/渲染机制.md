# Vue 渲染机制

## 虚拟 Dom 也称 VDom

VDom 就是通过 javascript 对象将真实 dom 对象描述出来，因为真实 dom 对象较大，因此只需将渲染必要相关的属性描述出来即可。提供渲染函数，将 VDom 渲染成真实的浏览器 dom。

当应用被挂载（mount）时，渲染器会遍历完整的 VDom 树，并依此构建真实 Dom 树。 当发生变化后，会生成第二份 VDom 树，渲染器会比较（diff） 2 份 VDom 树，只更新有变化的 dom（patch）。 这个过程只更新了变化的 dom，相对的减少了浏览器重绘回流

- 重绘：节点的变化，对整体布局无影响（颜色，背景等）
- 回流：节点的变化，对整体布局产生影响（大小，位置等）

### VDom 优点

- 浏览器性能提升
- 将 Vue 项目节藕，可以支持跨端（SSR , weex）

## 从顶层看渲染

- 编译：Vue 模版编译成渲染函数，返回完整的 VDom 树。此阶段可以在构建阶段完成，也可以在运行时完成
- 挂载：渲染器调用渲染函数，遍历返回 VDom 树，并创建真实 Dom 树。这一步作为响应式副作用执行，因此会追踪所以的响应式依赖
- 更新：当一个依赖更新之后，副作用会重新执行，创建一个新的 VDom 树。渲染器会遍历VDom树，跟久的Vdom树比较，然后更新真实的dom
